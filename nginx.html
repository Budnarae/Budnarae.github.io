<!DOCTYPE html> <html><head>
		<title>NGINX</title>
		<base href="../">
		<meta id="root-path" root-path="../">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, maximum-scale=5.0">
		<meta charset="UTF-8">
		<meta name="description" content="obsidian - NGINX">
		<meta property="og:title" content="NGINX">
		<meta property="og:description" content="obsidian - NGINX">
		<meta property="og:type" content="website">
		<meta property="og:url" content="public/nginx.html">
		<meta property="og:image" content="undefined">
		<meta property="og:site_name" content="obsidian">
		<link rel="alternate" type="application/rss+xml" title="RSS Feed" href="lib/rss.xml"><script async="" id="webpage-script" src="lib/scripts/webpage.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script type="module" async="" id="graph-view-script" src="lib/scripts/graph-view.js"></script><script async="" id="graph-wasm-script" src="lib/scripts/graph-wasm.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="graph-render-worker-script" src="lib/scripts/graph-render-worker.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="tinycolor-script" src="lib/scripts/tinycolor.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="pixi-script" src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.4.0/pixi.min.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="minisearch-script" src="https://cdn.jsdelivr.net/npm/minisearch@6.3.0/dist/umd/index.min.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><link rel="icon" href="lib/media/favicon.png"><script async="" id="graph-data-script" src="lib/scripts/graph-data.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><style>body{--line-width:40em;--line-width-adaptive:40em;--file-line-width:40em;--sidebar-width:min(20em, 80vw);--collapse-arrow-size:11px;--tree-horizontal-spacing:0.6em;--tree-vertical-spacing:0.6em;--sidebar-margin:12px}.sidebar{height:100%;min-width:calc(var(--sidebar-width) + var(--divider-width-hover));max-width:calc(var(--sidebar-width) + var(--divider-width-hover));font-size:14px;z-index:10;position:relative;overflow:hidden;transition:min-width ease-in-out,max-width ease-in-out;transition-duration:.2s;contain:size}.sidebar-left{left:0}.sidebar-right{right:0}.sidebar.is-collapsed{min-width:0;max-width:0}body.floating-sidebars .sidebar{position:absolute}.sidebar-content{height:100%;min-width:calc(var(--sidebar-width) - var(--divider-width-hover));top:0;padding:var(--sidebar-margin);padding-top:4em;line-height:var(--line-height-tight);background-color:var(--background-secondary);transition:background-color,border-right,border-left,box-shadow;transition-duration:var(--color-fade-speed);transition-timing-function:ease-in-out;position:absolute;display:flex;flex-direction:column}.sidebar:not(.is-collapsed) .sidebar-content{min-width:calc(max(100%,var(--sidebar-width)) - 3px);max-width:calc(max(100%,var(--sidebar-width)) - 3px)}.sidebar-left .sidebar-content{left:0;border-top-right-radius:var(--radius-l);border-bottom-right-radius:var(--radius-l)}.sidebar-right .sidebar-content{right:0;border-top-left-radius:var(--radius-l);border-bottom-left-radius:var(--radius-l)}.sidebar:has(.sidebar-content:empty):has(.topbar-content:empty){display:none}.sidebar-topbar{height:2em;width:var(--sidebar-width);top:var(--sidebar-margin);padding-inline:var(--sidebar-margin);z-index:1;position:fixed;display:flex;align-items:center;transition:width ease-in-out;transition-duration:inherit}.sidebar.is-collapsed .sidebar-topbar{width:calc(2.3em + var(--sidebar-margin) * 2)}.sidebar .sidebar-topbar.is-collapsed{width:0}.sidebar-left .sidebar-topbar{left:0}.sidebar-right .sidebar-topbar{right:0}.topbar-content{overflow:hidden;overflow:clip;width:100%;height:100%;display:flex;align-items:center;transition:inherit}.sidebar.is-collapsed .topbar-content{width:0;transition:inherit}.clickable-icon.sidebar-collapse-icon{background-color:transparent;color:var(--icon-color-focused);padding:0!important;margin:0!important;height:100%!important;width:2.3em!important;margin-inline:0.14em!important;position:absolute}.sidebar-left .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);right:var(--sidebar-margin)}.sidebar-right .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);left:var(--sidebar-margin)}.clickable-icon.sidebar-collapse-icon svg.svg-icon{width:100%;height:100%}.sidebar-section-header{margin:0 0 1em 0;text-transform:uppercase;letter-spacing:.06em;font-weight:600}body{transition:background-color var(--color-fade-speed) ease-in-out}.webpage-container{display:flex;flex-direction:row;height:100%;width:100%;align-items:stretch;justify-content:center}.document-container{opacity:1;flex-basis:100%;max-width:100%;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;transition:opacity .2s ease-in-out;contain:inline-size}.hide{opacity:0;transition:opacity .2s ease-in-out}.document-container>.markdown-preview-view{margin:var(--sidebar-margin);margin-bottom:0;width:100%;width:-webkit-fill-available;width:-moz-available;width:fill-available;background-color:var(--background-primary);transition:background-color var(--color-fade-speed) ease-in-out;border-top-right-radius:var(--window-radius,var(--radius-m));border-top-left-radius:var(--window-radius,var(--radius-m));overflow-x:hidden!important;overflow-y:auto!important;display:flex!important;flex-direction:column!important;align-items:center!important;contain:inline-size}.document-container>.markdown-preview-view>.markdown-preview-sizer{padding-bottom:80vh!important;width:100%!important;max-width:var(--line-width)!important;flex-basis:var(--line-width)!important;transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}.markdown-rendered img:not([width]),.view-content img:not([width]){max-width:100%;outline:0}.document-container>.view-content.embed{display:flex;padding:1em;height:100%;width:100%;align-items:center;justify-content:center}.document-container>.view-content.embed>*{max-width:100%;max-height:100%;object-fit:contain}:has(> :is(.math,table)){overflow-x:auto!important}.document-container>.view-content{overflow-x:auto;contain:content;padding:0;margin:0;height:100%}.scroll-highlight{position:absolute;width:100%;height:100%;pointer-events:none;z-index:1000;background-color:hsla(var(--color-accent-hsl),.25);opacity:0;padding:1em;inset:50%;translate:-50% -50%;border-radius:var(--radius-s)}</style><script defer="">async function loadIncludes(){if("file:"!=location.protocol){let e=document.querySelectorAll("include");for(let t=0;t<e.length;t++){let o=e[t],l=o.getAttribute("src");try{const e=await fetch(l);if(!e.ok){console.log("Could not include file: "+l),o?.remove();continue}let t=await e.text(),n=document.createRange().createContextualFragment(t),i=Array.from(n.children);for(let e of i)e.classList.add("hide"),e.style.transition="opacity 0.5s ease-in-out",setTimeout((()=>{e.classList.remove("hide")}),10);o.before(n),o.remove(),console.log("Included file: "+l)}catch(e){o?.remove(),console.log("Could not include file: "+l,e);continue}}}else{if(document.querySelectorAll("include").length>0){var e=document.createElement("div");e.id="error",e.textContent="Web server exports must be hosted on an http / web server to be viewed correctly.",e.style.position="fixed",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.fontSize="1.5em",e.style.fontWeight="bold",e.style.textAlign="center",document.body.appendChild(e),document.querySelector(".document-container")?.classList.remove("hide")}}}document.addEventListener("DOMContentLoaded",(()=>{loadIncludes()}));let isFileProtocol="file:"==location.protocol;function waitLoadScripts(e,t){let o=e.map((e=>document.getElementById(e+"-script"))),l=0;!function e(){let n=o[l];l++,n&&"true"!=n.getAttribute("loaded")||l<o.length&&e(),l<o.length?n.addEventListener("load",e):t()}()}</script><link rel="stylesheet" href="lib/styles/obsidian.css"><link rel="stylesheet" href="lib/styles/theme.css"><link rel="preload" href="lib/styles/global-variable-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/global-variable-styles.css"></noscript><link rel="preload" href="lib/styles/supported-plugins.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/supported-plugins.css"></noscript><link rel="preload" href="lib/styles/main-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/main-styles.css"></noscript></head><body class="publish css-settings-manager theme-dark show-inline-title show-ribbon"><script defer="">let theme=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");"dark"==theme?(document.body.classList.add("theme-dark"),document.body.classList.remove("theme-light")):(document.body.classList.add("theme-light"),document.body.classList.remove("theme-dark")),window.innerWidth<480?document.body.classList.add("is-phone"):window.innerWidth<768?document.body.classList.add("is-tablet"):window.innerWidth<1024?document.body.classList.add("is-small-screen"):document.body.classList.add("is-large-screen")</script><div class="webpage-container workspace"><div class="sidebar-left sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"><label class="theme-toggle-container" for="theme_toggle"><input class="theme-toggle-input" type="checkbox" id="theme_toggle"><div class="toggle-background"></div></label></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="search-input-container"><input enterkeyhint="search" type="search" spellcheck="false" placeholder="Search..."><div class="search-input-clear-button" aria-label="Clear search"></div></div><include src="lib/html/file-tree.html"></include></div><script defer="">let ls = document.querySelector(".sidebar-left"); ls.classList.add("is-collapsed"); if (window.innerWidth > 768) ls.classList.remove("is-collapsed"); ls.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-left-width"));</script></div><div class="document-container markdown-reading-view hide"><div class="markdown-preview-view markdown-rendered allow-fold-headings allow-fold-lists is-readable-line-width"><style id="MJX-CHTML-styles"></style><div class="markdown-preview-sizer markdown-preview-section"><h1 class="page-title heading inline-title" id="NGINX"><p dir="auto">NGINX</p></h1><div class="el-hr"><hr></div><div class="el-p"><p dir="auto"><a href="?query=tag:web" class="tag" target="_blank" rel="noopener nofollow">#web</a> <a href="?query=tag:server/web_server" class="tag" target="_blank" rel="noopener nofollow">#server/web_server</a> <a href="?query=tag:uncomplete" class="tag" target="_blank" rel="noopener nofollow">#uncomplete</a></p></div><div class="el-p"><p dir="auto"><em>engine x</em></p></div><div class="el-hr"><hr></div><div class="el-p"><p dir="auto"><mark>본 문서는 미완성 문서입니다.</mark></p></div><div class="el-p"><p dir="auto">본 문서는 필요에 따라 <a data-tooltip-position="top" aria-label="https://nginx.org/" rel="noopener nofollow" class="external-link" href="https://nginx.org/" target="_blank">nginx 공식 문서</a>의 일부분만을 정리한 것입니다.<br>
누락한 부분은 <mark>누락</mark>과 같이 표시됩니다.<br>
누락한 부분은 차후 보충될 수도, 그렇지 않을 수도 있습니다.</p></div><div class="el-hr"><hr></div><div class="el-p"><p dir="auto"><strong>nginx</strong>는 다음의 기능을 수행할 수 있는 프로그램이다.</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">http 웹 서버</li>
<li data-line="1" dir="auto">리버스 프록시</li>
<li data-line="2" dir="auto">콘텐츠 캐시</li>
<li data-line="3" dir="auto">로드 밸런서</li>
<li data-line="4" dir="auto">tcp/udp 프록시 서버</li>
<li data-line="5" dir="auto">메일 프록시 서버</li>
</ul></div><div class="el-p"><p dir="auto">nginx는 하나의 <strong>master 프로세스</strong>와 여러 개의 <strong>worker 프로세스</strong>로 수행된다.</p></div><div class="el-p"><p dir="auto">master 프로세스는 config 파일을 읽고 분석하며, worker 프로세스를 유지 및 관리한다.<br>
worker 프로세스는 요청을 처리하는 작업을 담당한다.</p></div><div class="el-p"><p dir="auto">nginx는 event-based 모델을 사용하며 운영체제(아마도 리눅스)에 의존적이다. 이는 worker 프로세스들에게 작업을 효율적으로 분배하기 위해서이다. worker 프로세스의 개수는 configuration 파일에서 정의되며 현재 가용한 cpu 코어 수에 따라 조정될 수 있다.</p></div><div class="el-p"><p dir="auto">nginx가 동작하는 방식은 configuration 파일에 의해 정의된다. 일반적으로 configuration 파일은 <code>nginx.conf</code>라는 이름을 가지며 다음의 디렉토리 중 하나에 위치한다.</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto"><code>/usr/local/nginx/conf</code></li>
<li data-line="1" dir="auto"><code>/etc/nginx</code></li>
<li data-line="2" dir="auto"><code>/usr/local/etc/nginx</code></li>
</ul></div><div class="el-h1 heading-wrapper"><h1 data-heading="설치" dir="auto" class="heading" id="설치">설치</h1><div class="heading-children"><div class="el-p"><p dir="auto"><a data-tooltip-position="top" aria-label="https://nginx.org/en/docs/install.html" rel="noopener nofollow" class="external-link" href="https://nginx.org/en/docs/install.html" target="_blank">nginx 공식 문서</a> 참조</p></div></div></div><div class="el-h1 heading-wrapper"><h1 data-heading="Beginner's Guide" dir="auto" class="heading" id="Beginner's_Guide">Beginner's Guide</h1><div class="heading-children"><div class="el-h2 heading-wrapper"><h2 data-heading="시작, 정지, 그리고 설정 파일 리로딩" dir="auto" class="heading" id="시작,_정지,_그리고_설정_파일_리로딩"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>시작, 정지, 그리고 설정 파일 리로딩</h2><div class="heading-children"><div class="el-p"><p dir="auto">nginx를 시작하기 위해선 실행파일을 동작시킨다.</p></div><div class="el-p"><p dir="auto">동작 중인 nginx를 제어하기 위해서는 -s 매개변수를 사용하여 응용 프로그램을 동작시킨다.<br>
다음의 문법을 따른다.</p></div><div class="el-p"><p dir="auto"><code>nginx -s &lt;signal&gt;</code></p></div><div class="el-p"><p dir="auto"><strong>signal</strong> 위치에는 다음의 인자들이 위치할 수 있다.</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">stop : 빠른 강제 종료</li>
<li data-line="1" dir="auto">quit : 우아한(graceful) 종료</li>
<li data-line="2" dir="auto">reload : configuration file을 reload함</li>
<li data-line="3" dir="auto">reopen : log 파일을 다시 염</li>
</ul></div><div class="el-p"><p dir="auto">예를 들어, 현재 요청을 처리하기 위해 동작 중인 worker 프로세스들을 정지하기 위해서는 아래의 커맨드를 동작한다.</p></div><div class="el-p"><p dir="auto"><code>nginx -s quit</code></p></div><div class="el-blockquote"><blockquote dir="auto">
<p>이 커맨드는 nginx를 실행시킨 유저와 동일한 유저에 의하여 호출되어야 한다.</p>
</blockquote></div><div class="el-p"><p dir="auto">configuration 파일이 수정되어도 그것이 reload 되거나 nginx가 다시 시작하기 전까지는 수정사항이 반영되지 않는다. configuration 파일을 reload 하려면 아래의 커맨드를 동작시킨다.</p></div><div class="el-p"><p dir="auto"><code>nginx -s reload</code></p></div><div class="el-p"><p dir="auto">master 프로세스는 reload configuration 신호를 받으면, 수정된 configuration 파일의 유효성을 확인하고 변경사항을 적용한다.</p></div><div class="el-p"><p dir="auto">이 작업이 성공한다면, master 프로세스는 새로운 worker 프로세스를 생성하고 기존에 존재하던 worker 프로세스에게는 종료 명령을 보낸다.</p></div><div class="el-p"><p dir="auto">이 작업이 실패한다면, master 프로세스는 변경 사항을 롤백하고 기존 configuration 파일에 따라 작업을 계속한다.</p></div><div class="el-p"><p dir="auto">종료 명령을 받은 worker 프로세스는 새로운 요청을 받는 것을 중단한 후, 제공하고 있던 요청(=서비스)를 마저 제공한다. 그런 후 exit 한다.</p></div><div class="el-p"><p dir="auto">unix의 kill 유틸리티를 이용하여 신호를 보낼 수도 있다. 이 경우 신호를 보내고자 하는 프로세스의 id를 알아야 한다. nginx master 프로세스의 id는 일반적으로 <code>/usr/local/nginx/logs/nginx.pid</code>에 저장되어 있다.<br>
아래와 같은 명령어를 사용한다.</p></div><div class="el-p"><p dir="auto"><code>kill -s QUIT &lt;nginx master process id&gt;</code></p></div><div class="el-p"><p dir="auto"><code>ps</code> 명령을 통해 현재 동작 중인 nginx 프로세스들의 목록을 가져올 수도 있다.</p></div><div class="el-p"><p dir="auto"><code>ps -ax | grep nginx</code></p></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="Configuration 파일의 구조" dir="auto" class="heading" id="Configuration_파일의_구조"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Configuration 파일의 구조</h2><div class="heading-children"><div class="el-p"><p dir="auto">nginx는 configuration 파일에 열거된 지침(directives)을 따른다. 지시 사항은 단순한 지침(simple directives)와 블록 지침(block directives)로 나뉜다.</p></div><div class="el-p"><p dir="auto">단순한 지침은 아래와 같은 형식을 취한다.</p></div><div class="el-p"><p dir="auto"><code>name parameter;</code></p></div><div class="el-p"><p dir="auto">블록 지침은 다른 여러 개의 지침들을 <code>{</code>, <code>}</code>로 둘러싸는 형태로 보유할 수 있으며, 이를 context(문맥)라고 부른다(예 : events, http, server, location).</p></div><div class="el-pre"><pre><code data-line="0">http {
	server {
	}
}
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">configuration 파일에 있는 모든 지침들은 어디에 위치해있던지 main context에 존재하는 것으로 간주한다(<em>오역의 가능성 있음</em>).</p></div><div class="el-p"><p dir="auto"><code>#</code> 기호 뒤에 오는 문장은 주석으로 간주한다.</p></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="정적 컨텐츠 제공하기" dir="auto" class="heading" id="정적_컨텐츠_제공하기"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>정적 컨텐츠 제공하기</h2><div class="heading-children"><div class="el-p"><p dir="auto">웹 서버의 주요 업무는 이미지나 정적 html 페이지 같은 파일을 제공하는 것이다.</p></div><div class="el-p"><p dir="auto">html 파일은 보통 <code>/data/www</code> 디렉토리에 위치해 있고<br>
이미지 파일은 보통 <code>/data/images</code>에 위치해 있다.</p></div><div class="el-p"><p dir="auto">http 블록 내부의 server 블록에 두 개의 location 블록을 설정함으로서 이를 설정할 수 있다.<br>
아래와 같은 절차를 통해 예제를 진행해보자.</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">
<p><code>/data/www</code> 디렉토리를 만든 후 그 안에 <code>index.html</code>을 위치시킨다. <code>index.html</code>에는 어떠한 내용이 있어도 괜찮다.</p>
</li>
<li data-line="1" dir="auto">
<p><code>/data/image</code> 디렉토리를 만든 후 그 안에 아무 이미지나 넣는다.</p>
</li>
<li data-line="2" dir="auto">
<p>configuration 파일을 연다. 파일 안에는 이미 여러 개의 server 블록이 있을 것이고 그 중에서는 주석 처리가 된 것도, 그렇지 않은 것도 있을 것이다. 주석 처리되지 않은 모든 server 블록을 주석처리하고 아래와 같이 새로운 server 블록을 만든다.</p>
<pre><code data-line="4">http {
	server {
	}
}
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre>
</li>
</ol></div><div class="el-blockquote"><blockquote dir="auto">
<p>일반적으로 configuration 파일 내부에는 수신하고 있는 포트 번호, 그리고 서버의 이름에 따라 여러 개의 server 블록이 있다. nginx는 요청의 헤더 부분에 있는 URI를 분석하여 server 블록 내부의 location 지침에 있는 인자와 대조함으로서 어느 서버가 요청을 수행할지를 결정한다.</p>
</blockquote></div><div class="el-ol"><ol start="4">
<li data-line="0" dir="auto">
<p>다음의 location 블록을 server 블록에 더한다.</p>
<pre><code data-line="2">location / {
	root /data/www;
}
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre>
<pre><code data-line="8">location /images/ {
	root /data;
}
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre>
</li>
</ol></div><div class="el-blockquote"><blockquote dir="auto">
<p>URI의 경로는 root 지침의 인자와 location 지침의 인자를 조합한 결과물과 대조된다. <code>/data/images</code> 블록을 보면 경로가 역순으로 되어 있는데(하위 디렉토리인 /images/ 가 상단에 있고 상위 디렉토리인 /data/가 하단에 있음) 이는 탐색의 효율성을 위해서이다.<br>
예를 들어 <code>/data/www</code>와 <code>/data/images</code>를 구별하는 것은 상위 디렉토리인 <code>/data</code>가 아니라 하위 디렉토리인 <code>/www</code>와 <code>/images</code>이다. 따라서 둘 중 <code>/data/www</code>를 탐색하는 경우 상위 디렉토리 -&gt; 하위 디렉토리 순으로 검색하는 것보다 하위 디렉토리 -&gt; 상위 디렉토리 순으로 검색하는 것이 빠를 것이다.<br>
따라서 configuration 파일에서는 하위 디렉토리를 location 지침의 인자로, 상위 디렉토리를 root 지침의 인자로 전달한다.<br>
참고로 configuration 파일은 인자의 길이가 긴 location 블록을 우선적으로 탐색한다.</p>
</blockquote></div><div class="el-p"><p dir="auto">위 과정이 완료되면 위 설정 파일은 80 포트(nginx의 기본 포트이다)로 웹 서비스를 제공하라는 의미를 가지게 된다.</p></div><div class="el-p"><p dir="auto"><code>http://localhost/</code> 뒤에 <code>/images/</code>가 붙으면 <code>/data/images/</code>의 파일을 제공하게 된다.</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">ex. <code>http://localhost/images/example.png</code> 주소는 <code>/data/images/example.png</code>를 제공하라는 뜻</li>
</ul></div><div class="el-p"><p dir="auto"><code>/images/</code> 외의 다른 경로는 <code>/data/www/</code>의 파일을 제공하게 된다.</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">ex. <code>http://localhost/images/some/example.html</code>은 <code>/data/www/some/example.html</code>을 제공하라는 뜻</li>
</ul></div><div class="el-blockquote"><blockquote dir="auto">
<p>예상대로 작업이 수행되지 않는다면 <code>access.log</code>와 <code>error.log</code> 파일에 이유가 기록되어 있을 수 있다. 두 파일은 보통 <code>/usr/local/nginx/logs</code>나 <code>/var/log/nginx</code>에 위치해 있다.</p>
</blockquote></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="간단한 프록시 서버 구축하기" dir="auto" class="heading" id="간단한_프록시_서버_구축하기"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>간단한 프록시 서버 구축하기</h2><div class="heading-children"><div class="el-p"><p dir="auto">nginx의 주된 기능 중 하나는 <strong>프록시 서버</strong>를 구축하는 것이다. 프록시 서버란 클라이언트부터 요청을 받아 또다른 서버(보통 proxied 서버라 칭한다.)에게 그 요청을 전달해주는, 일종의 중개 역할을 하는 서버를 칭한다.</p></div><div class="el-p"><p dir="auto">다음의 예제를 진행하여 단순한 프록시 서버를 만들어보자. 우리가 만들 프록시 서버는 이미지 파일 요청은 로컬 디렉토리에 있는 파일을 제공하고, 다른 요청은 proxied 서버로 전달해주는 기능을 한다.</p></div><div class="el-p"><p dir="auto"><a data-tooltip-position="top" aria-label="NGINX > ^0bc08f" data-href="NGINX#^0bc08f" href="public/nginx.html#^0bc08f" class="internal-link" target="_self" rel="noopener nofollow">정적 컨텐츠 제공하기</a>에서 만든 configuration 파일에 아래와 같은 서버 블록을 추가한다.</p></div><div class="el-pre"><pre><code data-line="0">server {
	listen 8080;
	root /data/upl;

	location / {
	}
}
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-blockquote"><blockquote dir="auto">
<p><code>listen</code> 지침은 해당 서버가 어느 포트를 사용해서 수신할 지를 명시한다. 만약 listen이 server 블록 내에 정의되지 않았다면, 기본 포트인 80포트를 사용하여 수신한다.</p>
<p><code>location / {}</code>와 같이 location 지침 내부에 아무것도 지정이 안 되어 있을 경우, <code>root /data/upl;</code>와 같이 서버 블록이 독자적으로 root 지침을 보유한다.</p>
</blockquote></div><div class="el-p"><p dir="auto">이제 본격적으로 proxy 서버 설정을 하는 부분을 configuration 파일에 추가해보자.<br>
<a data-tooltip-position="top" aria-label="NGINX > ^0bc08f" data-href="NGINX#^0bc08f" href="public/nginx.html#^0bc08f" class="internal-link" target="_self" rel="noopener nofollow">정적 컨텐츠 제공하기</a>에서 만들었던 server 블록을 아래와 같이 수정한다.</p></div><div class="el-pre"><pre><code data-line="0">server {
	location / {
		proxy_pass http://localhost:8080;
	}

	location /images/ {
		root /data;
	}
}
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-blockquote"><blockquote dir="auto">
<p><code>proxy_pass</code> 지침은 클라이언트의 요청을 전달할 proxied 서버의 server name과 포트 번호를 기재한다. 위 configuration 파일의 경우, <code>http://localhost:8080</code>이다.</p>
</blockquote></div><div class="el-p"><p dir="auto">아까의 블록에서 <code>location /images/</code> 블록을 아래와 같이 수정한다.</p></div><div class="el-pre"><pre><code data-line="0">location ~ \.(gif|jpg|png)$ {
	root /data/images;
}
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-blockquote"><blockquote dir="auto">
<p>위 블록은 파일 중 gif, jpg, png 확장자를 가지는 파일만을 로컬의 <code>/data/images</code> 디렉토리로 매핑하겠다는 <strong>정규 표현식</strong>이다. 이러한 형태의 표현식은 반드시 <code>~</code>기호로 시작해야 한다.<br>
nginx가 요청을 처리하기 위해 location 블록을 선택할 때, 먼저 접두사를 지정한 location 지시어를 확인하여 가장 긴 접두사를 기억하고, 그 다음에 정규 표현식을 확인한다. 정규 표현식이 일치하는 경우 nginx는 해당 location을 선택하고, 그렇지 않으면 이전에 기억된 location을 선택한다.</p>
</blockquote></div><div class="el-pre"><pre><code data-line="0">server {
	location / {
		proxy_pass http://localhost:8080;
	}

	location ~ \.(gif/jpg/png)$ {
		root /data/images;
	}
}
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-blockquote"><blockquote dir="auto">
<p>즉 위 server 블록에서 요청을 처리하기 위한 location 블록을 선택할 때, gif, jpg, pnd 형식의 파일은 모두 로컬의 <code>/data/images/</code> 디렉토리로 매핑되고, 그 외 요청은 <code>localhost:8080</code> 서버로 넘어간다.</p>
</blockquote></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="FastCGI Proxing 구축하기" dir="auto" class="heading" id="FastCGI_Proxing_구축하기"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>FastCGI Proxing 구축하기</h2><div class="heading-children"><div class="el-p"><p dir="auto">nginx는 <strong>FastCGI 서버</strong>로 통하는 경로를 요청하는 데 사용될 수도 있다. FastCGI 서버란 다양한 프레임워크와 프로그래밍 언어로 짜여진 응용 프로그램을 실행시켜 주는 서버이다.</p></div><div class="el-p"><p dir="auto">FastCGI 서버로의 매핑을 요청하려면 <code>fastcgi_pass</code> 지침에 <code>server_name:port</code>의 형태로 인자를 전달해야 한다.<br>
PHP에서는 스크립트의 이름을 정의하기 위해 <code>SCRIPT_FILENAME</code> 인자가 필요하고, 요청 인자를 전달하기 위해 <code>QUERY_STRING</code> 인자가 필요하다.</p></div><div class="el-p"><p dir="auto">결과적으로 다음과 같은 블록을 사용한다. <a data-tooltip-position="top" aria-label="NGINX > ^7fc5ba" data-href="NGINX#^7fc5ba" href="public/nginx.html#^7fc5ba" class="internal-link" target="_self" rel="noopener nofollow">간단한 프록시 서버 구축하기</a>에서 만든 configuration 파일에 다음 블록을 추가하여 보자.</p></div><div class="el-pre"><pre><code data-line="0">server {
	listen 90;
    location / {
        fastcgi_pass  localhost:9000;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_param QUERY_STRING    $query_string;
    }
}
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-blockquote"><blockquote dir="auto">
<p>위의 서버 블록은 90 포트로 들어오는 모든 요청을  <code>localhost:9000</code>에 위치한 FastCGI 서버로 전달해주는 역할을 한다.</p>
</blockquote></div><div class="el-hr"><hr></div><div class="el-p"><p dir="auto">참고자료</p></div><div class="el-p"><p dir="auto"><a href="?query=tag:%EC%B0%B8%EA%B3%A0%EB%A7%81%ED%81%AC/nginx_org" class="tag" target="_blank" rel="noopener nofollow">#참고링크/nginx_org</a> </p></div><div class="el-hr"><hr></div><div class="mod-footer mod-ui"></div></div></div></div></div></div></div></div><div class="sidebar-right sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="graph-view-wrapper"><div class="sidebar-section-header">Interactive Graph</div><div class="graph-view-placeholder">
		<div class="graph-view-container">
			<div class="graph-icon graph-expand" role="button" aria-label="Expand" data-tooltip-position="top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><line x1="7" y1="17" x2="17" y2="7"></line><polyline points="7 7 17 7 17 17"></polyline></svg></div>
			<canvas id="graph-canvas" class="hide" width="512px" height="512px"></canvas>
		</div>
		</div></div><div class="tree-container mod-root nav-folder tree-item outline-tree" data-depth="0"><div class="tree-header"><span class="sidebar-section-header">Table Of Contents</span><button class="clickable-icon collapse-tree-button" aria-label="Collapse All"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg></button></div><div class="tree-scroll-area tree-item-children nav-folder-children"><div class="tree-item mod-tree-folder nav-folder mod-collapsible is-collapsed" style="display: none;"></div><div class="tree-item" data-depth="1"><a class="tree-link" href="public\nginx.html#NGINX"><div class="tree-item-contents heading-link" heading-name="NGINX"><span class="tree-item-title">NGINX</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="public\nginx.html#설치"><div class="tree-item-contents heading-link" heading-name="설치"><span class="tree-item-title">설치</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="public\nginx.html#Beginner's_Guide"><div class="tree-item-contents heading-link" heading-name="Beginner's Guide"><span class="tree-item-title">Beginner's Guide</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="2"><a class="tree-link" href="public\nginx.html#시작,_정지,_그리고_설정_파일_리로딩"><div class="tree-item-contents heading-link" heading-name="시작, 정지, 그리고 설정 파일 리로딩"><span class="tree-item-title">시작, 정지, 그리고 설정 파일 리로딩</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="public\nginx.html#Configuration_파일의_구조"><div class="tree-item-contents heading-link" heading-name="Configuration 파일의 구조"><span class="tree-item-title">Configuration 파일의 구조</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="public\nginx.html#정적_컨텐츠_제공하기"><div class="tree-item-contents heading-link" heading-name="정적 컨텐츠 제공하기"><span class="tree-item-title">정적 컨텐츠 제공하기</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="public\nginx.html#간단한_프록시_서버_구축하기"><div class="tree-item-contents heading-link" heading-name="간단한 프록시 서버 구축하기"><span class="tree-item-title">간단한 프록시 서버 구축하기</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="public\nginx.html#FastCGI_Proxing_구축하기"><div class="tree-item-contents heading-link" heading-name="FastCGI Proxing 구축하기"><span class="tree-item-title">FastCGI Proxing 구축하기</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div></div></div></div><script defer="">let rs = document.querySelector(".sidebar-right"); rs.classList.add("is-collapsed"); if (window.innerWidth > 768) rs.classList.remove("is-collapsed"); rs.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-right-width"));</script></div></div></body></html>